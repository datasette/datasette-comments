var F,d,le,Me,q,re,ce,G,Pe,N={},ue=[],Ne=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,J=Array.isArray;function x(t,e){for(var n in e)t[n]=e[n];return t}function de(t){var e=t.parentNode;e&&e.removeChild(t)}function f(t,e,n){var o,i,_,a={};for(_ in e)_=="key"?o=e[_]:_=="ref"?i=e[_]:a[_]=e[_];if(arguments.length>2&&(a.children=arguments.length>3?F.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(_ in t.defaultProps)a[_]===void 0&&(a[_]=t.defaultProps[_]);return R(t,a,o,i,null)}function R(t,e,n,o,i){var _={type:t,props:e,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++le};return i==null&&d.vnode!=null&&d.vnode(_),_}function B(t){return t.children}function V(t,e){this.props=t,this.context=e}function L(t,e){if(e==null)return t.__?L(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?L(t):null}function fe(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return fe(t)}}function _e(t){(!t.__d&&(t.__d=!0)&&q.push(t)&&!Z.__r++||re!==d.debounceRendering)&&((re=d.debounceRendering)||ce)(Z)}function Z(){var t,e,n,o,i,_,a,c,l;for(q.sort(G);t=q.shift();)t.__d&&(e=q.length,o=void 0,i=void 0,_=void 0,c=(a=(n=t).__v).__e,(l=n.__P)&&(o=[],i=[],(_=x({},a)).__v=a.__v+1,Q(l,a,_,n.__n,l.ownerSVGElement!==void 0,a.__h!=null?[c]:null,o,c??L(a),a.__h,i),ve(o,a,i),a.__e!=c&&fe(a)),q.length>e&&q.sort(G));Z.__r=0}function me(t,e,n,o,i,_,a,c,l,m,u){var r,v,h,s,p,M,g,b,k,w=0,T=o&&o.__k||ue,D=T.length,E=D,P=e.length;for(n.__k=[],r=0;r<P;r++)(s=n.__k[r]=(s=e[r])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"?R(null,s,null,null,s):J(s)?R(B,{children:s},null,null,null):s.__b>0?R(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=n,s.__b=n.__b+1,(b=De(s,T,g=r+w,E))===-1?h=N:(h=T[b]||N,T[b]=void 0,E--),Q(t,s,h,i,_,a,c,l,m,u),p=s.__e,(v=s.ref)&&h.ref!=v&&(h.ref&&X(h.ref,null,s),u.push(v,s.__c||p,s)),p!=null&&(M==null&&(M=p),(k=h===N||h.__v===null)?b==-1&&w--:b!==g&&(b===g+1?w++:b>g?E>P-g?w+=b-g:w--:w=b<g&&b==g-1?b-g:0),g=r+w,typeof s.type!="function"||b===g&&h.__k!==s.__k?typeof s.type=="function"||b===g&&!k?s.__d!==void 0?(l=s.__d,s.__d=void 0):l=p.nextSibling:l=pe(t,p,l):l=he(s,l,t),typeof n.type=="function"&&(n.__d=l))):(h=T[r])&&h.key==null&&h.__e&&(h.__e==l&&(l=L(h)),K(h,h,!1),T[r]=null);for(n.__e=M,r=D;r--;)T[r]!=null&&(typeof n.type=="function"&&T[r].__e!=null&&T[r].__e==n.__d&&(n.__d=T[r].__e.nextSibling),K(T[r],T[r]))}function he(t,e,n){for(var o,i=t.__k,_=0;i&&_<i.length;_++)(o=i[_])&&(o.__=t,e=typeof o.type=="function"?he(o,e,n):pe(n,o.__e,e));return e}function pe(t,e,n){return n==null||n.parentNode!==t?t.insertBefore(e,null):e==n&&e.parentNode!=null||t.insertBefore(e,n),e.nextSibling}function De(t,e,n,o){var i=t.key,_=t.type,a=n-1,c=n+1,l=e[n];if(l===null||l&&i==l.key&&_===l.type)return n;if(o>(l!=null?1:0))for(;a>=0||c<e.length;){if(a>=0){if((l=e[a])&&i==l.key&&_===l.type)return a;a--}if(c<e.length){if((l=e[c])&&i==l.key&&_===l.type)return c;c++}}return-1}function Le(t,e,n,o,i){var _;for(_ in n)_==="children"||_==="key"||_ in e||U(t,_,null,n[_],o);for(_ in e)i&&typeof e[_]!="function"||_==="children"||_==="key"||_==="value"||_==="checked"||n[_]===e[_]||U(t,_,e[_],n[_],o)}function ie(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Ne.test(e)?n:n+"px"}function U(t,e,n,o,i){var _;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof o=="string"&&(t.style.cssText=o=""),o)for(e in o)n&&e in n||ie(t.style,e,"");if(n)for(e in n)o&&n[e]===o[e]||ie(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")_=e!==(e=e.replace(/(PointerCapture)$|Capture$/,"$1")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+_]=n,n?o||t.addEventListener(e,_?se:ae,_):t.removeEventListener(e,_?se:ae,_);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e!=="rowSpan"&&e!=="colSpan"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,n))}}function ae(t){return this.l[t.type+!1](d.event?d.event(t):t)}function se(t){return this.l[t.type+!0](d.event?d.event(t):t)}function Q(t,e,n,o,i,_,a,c,l,m){var u,r,v,h,s,p,M,g,b,k,w,T,D,E,P,C=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(l=n.__h,c=e.__e=n.__e,e.__h=null,_=[c]),(u=d.__b)&&u(e);e:if(typeof C=="function")try{if(g=e.props,b=(u=C.contextType)&&o[u.__c],k=u?b?b.props.value:u.__:o,n.__c?M=(r=e.__c=n.__c).__=r.__E:("prototype"in C&&C.prototype.render?e.__c=r=new C(g,k):(e.__c=r=new V(g,k),r.constructor=C,r.render=Ie),b&&b.sub(r),r.props=g,r.state||(r.state={}),r.context=k,r.__n=o,v=r.__d=!0,r.__h=[],r._sb=[]),r.__s==null&&(r.__s=r.state),C.getDerivedStateFromProps!=null&&(r.__s==r.state&&(r.__s=x({},r.__s)),x(r.__s,C.getDerivedStateFromProps(g,r.__s))),h=r.props,s=r.state,r.__v=e,v)C.getDerivedStateFromProps==null&&r.componentWillMount!=null&&r.componentWillMount(),r.componentDidMount!=null&&r.__h.push(r.componentDidMount);else{if(C.getDerivedStateFromProps==null&&g!==h&&r.componentWillReceiveProps!=null&&r.componentWillReceiveProps(g,k),!r.__e&&(r.shouldComponentUpdate!=null&&r.shouldComponentUpdate(g,r.__s,k)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(r.props=g,r.state=r.__s,r.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(O){O&&(O.__=e)}),w=0;w<r._sb.length;w++)r.__h.push(r._sb[w]);r._sb=[],r.__h.length&&a.push(r);break e}r.componentWillUpdate!=null&&r.componentWillUpdate(g,r.__s,k),r.componentDidUpdate!=null&&r.__h.push(function(){r.componentDidUpdate(h,s,p)})}if(r.context=k,r.props=g,r.__P=t,r.__e=!1,T=d.__r,D=0,"prototype"in C&&C.prototype.render){for(r.state=r.__s,r.__d=!1,T&&T(e),u=r.render(r.props,r.state,r.context),E=0;E<r._sb.length;E++)r.__h.push(r._sb[E]);r._sb=[]}else do r.__d=!1,T&&T(e),u=r.render(r.props,r.state,r.context),r.state=r.__s;while(r.__d&&++D<25);r.state=r.__s,r.getChildContext!=null&&(o=x(x({},o),r.getChildContext())),v||r.getSnapshotBeforeUpdate==null||(p=r.getSnapshotBeforeUpdate(h,s)),me(t,J(P=u!=null&&u.type===B&&u.key==null?u.props.children:u)?P:[P],e,n,o,i,_,a,c,l,m),r.base=e.__e,e.__h=null,r.__h.length&&a.push(r),M&&(r.__E=r.__=null)}catch(O){e.__v=null,(l||_!=null)&&(e.__e=c,e.__h=!!l,_[_.indexOf(c)]=null),d.__e(O,e,n)}else _==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Ae(n.__e,e,n,o,i,_,a,l,m);(u=d.diffed)&&u(e)}function ve(t,e,n){for(var o=0;o<n.length;o++)X(n[o],n[++o],n[++o]);d.__c&&d.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(_){_.call(i)})}catch(_){d.__e(_,i.__v)}})}function Ae(t,e,n,o,i,_,a,c,l){var m,u,r,v=n.props,h=e.props,s=e.type,p=0;if(s==="svg"&&(i=!0),_!=null){for(;p<_.length;p++)if((m=_[p])&&"setAttribute"in m==!!s&&(s?m.localName===s:m.nodeType===3)){t=m,_[p]=null;break}}if(t==null){if(s===null)return document.createTextNode(h);t=i?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s,h.is&&h),_=null,c=!1}if(s===null)v===h||c&&t.data===h||(t.data=h);else{if(_=_&&F.call(t.childNodes),u=(v=n.props||N).dangerouslySetInnerHTML,r=h.dangerouslySetInnerHTML,!c){if(_!=null)for(v={},p=0;p<t.attributes.length;p++)v[t.attributes[p].name]=t.attributes[p].value;(r||u)&&(r&&(u&&r.__html==u.__html||r.__html===t.innerHTML)||(t.innerHTML=r&&r.__html||""))}if(Le(t,h,v,i,c),r)e.__k=[];else if(me(t,J(p=e.props.children)?p:[p],e,n,o,i&&s!=="foreignObject",_,a,_?_[0]:n.__k&&L(n,0),c,l),_!=null)for(p=_.length;p--;)_[p]!=null&&de(_[p]);c||("value"in h&&(p=h.value)!==void 0&&(p!==t.value||s==="progress"&&!p||s==="option"&&p!==v.value)&&U(t,"value",p,v.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==t.checked&&U(t,"checked",p,v.checked,!1))}return t}function X(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(o){d.__e(o,n)}}function K(t,e,n){var o,i;if(d.unmount&&d.unmount(t),(o=t.ref)&&(o.current&&o.current!==t.__e||X(o,null,e)),(o=t.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(_){d.__e(_,e)}o.base=o.__P=null,t.__c=void 0}if(o=t.__k)for(i=0;i<o.length;i++)o[i]&&K(o[i],e,n||typeof t.type!="function");n||t.__e==null||de(t.__e),t.__=t.__e=t.__d=void 0}function Ie(t,e,n){return this.constructor(t,n)}function Y(t,e,n){var o,i,_,a;d.__&&d.__(t,e),i=(o=typeof n=="function")?null:n&&n.__k||e.__k,_=[],a=[],Q(e,t=(!o&&n||e).__k=f(B,null,[t]),i||N,N,e.ownerSVGElement!==void 0,!o&&n?[n]:i?null:e.firstChild?F.call(e.childNodes):null,_,!o&&n?n:i?i.__e:e.firstChild,o,a),ve(_,t,a)}F=ue.slice,d={__e:function(t,e,n,o){for(var i,_,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((_=i.constructor)&&_.getDerivedStateFromError!=null&&(i.setState(_.getDerivedStateFromError(t)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,o||{}),a=i.__d),a)return i.__E=i}catch(c){t=c}throw t}},le=0,Me=function(t){return t!=null&&t.constructor===void 0},V.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=x({},this.state),typeof t=="function"&&(t=t(x({},n),this.props)),t&&x(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),_e(this))},V.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),_e(this))},V.prototype.render=B,q=[],ce=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,G=function(t,e){return t.__v.__b-e.__v.__b},Z.__r=0,Pe=0;var A={COMMENT_ADD:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M440-400h80v-120h120v-80H520v-120h-80v120H320v80h120v120ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>',CHECK_CIRCLE:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',ADD_REACTION:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-480Zm0 400q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q43 0 83 8.5t77 24.5v90q-35-20-75.5-31.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160q133 0 226.5-93.5T800-480q0-32-6.5-62T776-600h86q9 29 13.5 58.5T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm320-600v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM620-520q25 0 42.5-17.5T680-580q0-25-17.5-42.5T620-640q-25 0-42.5 17.5T560-580q0 25 17.5 42.5T620-520Zm-280 0q25 0 42.5-17.5T400-580q0-25-17.5-42.5T340-640q-25 0-42.5 17.5T280-580q0 25 17.5 42.5T340-520Zm140 260q68 0 123.5-38.5T684-400H276q25 63 80.5 101.5T480-260Z"/></svg>',COMMENT:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>'};var j,y,ee,ge,te=0,Ee=[],W=[],ye=d.__b,be=d.__r,Te=d.diffed,we=d.__c,Ce=d.unmount;function xe(t,e){d.__h&&d.__h(y,t,te||e),te=0;var n=y.__H||(y.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:W}),n.__[t]}function S(t){return te=1,Oe(He,t)}function Oe(t,e,n){var o=xe(j++,2);if(o.t=t,!o.__c&&(o.__=[n?n(e):He(void 0,e),function(c){var l=o.__N?o.__N[0]:o.__[0],m=o.t(l,c);l!==m&&(o.__N=[m,o.__[1]],o.__c.setState({}))}],o.__c=y,!y.u)){var i=function(c,l,m){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter(function(v){return v.__c});if(u.every(function(v){return!v.__N}))return!_||_.call(this,c,l,m);var r=!1;return u.forEach(function(v){if(v.__N){var h=v.__[0];v.__=v.__N,v.__N=void 0,h!==v.__[0]&&(r=!0)}}),!(!r&&o.__c.props===c)&&(!_||_.call(this,c,l,m))};y.u=!0;var _=y.shouldComponentUpdate,a=y.componentWillUpdate;y.componentWillUpdate=function(c,l,m){if(this.__e){var u=_;_=void 0,i(c,l,m),_=u}a&&a.call(this,c,l,m)},y.shouldComponentUpdate=i}return o.__N||o.__}function z(t,e){var n=xe(j++,3);!d.__s&&Ze(n.__H,e)&&(n.__=t,n.i=e,y.__H.__h.push(n))}function Re(){for(var t;t=Ee.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach($),t.__H.__h.forEach(ne),t.__H.__h=[]}catch(e){t.__H.__h=[],d.__e(e,t.__v)}}d.__b=function(t){y=null,ye&&ye(t)},d.__r=function(t){be&&be(t),j=0;var e=(y=t.__c).__H;e&&(ee===y?(e.__h=[],y.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=W,n.__N=n.i=void 0})):(e.__h.forEach($),e.__h.forEach(ne),e.__h=[],j=0)),ee=y},d.diffed=function(t){Te&&Te(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ee.push(e)!==1&&ge===d.requestAnimationFrame||((ge=d.requestAnimationFrame)||Ve)(Re)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==W&&(n.__=n.__V),n.i=void 0,n.__V=W})),ee=y=null},d.__c=function(t,e){e.some(function(n){try{n.__h.forEach($),n.__h=n.__h.filter(function(o){return!o.__||ne(o)})}catch(o){e.some(function(i){i.__h&&(i.__h=[])}),e=[],d.__e(o,n.__v)}}),we&&we(t,e)},d.unmount=function(t){Ce&&Ce(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{$(o)}catch(i){e=i}}),n.__H=void 0,e&&d.__e(e,n.__v))};var ke=typeof requestAnimationFrame=="function";function Ve(t){var e,n=function(){clearTimeout(o),ke&&cancelAnimationFrame(e),setTimeout(t)},o=setTimeout(n,100);ke&&(e=requestAnimationFrame(n))}function $(t){var e=y,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),y=e}function ne(t){var e=y;t.__c=t.__(),y=e}function Ze(t,e){return!t||t.length!==e.length||e.some(function(n,o){return n!==t[o]})}function He(t,e){return typeof e=="function"?e(t):e}async function I(t,e){let{method:n,data:o}=e??{};return fetch(`${t}`,{method:n,credentials:"include",headers:{"Content-Type":"application/json"},body:o?JSON.stringify(o):void 0}).then(i=>i.json())}var H=class{static async threadNew(e,n){return I("/-/datasette-comments/thread/new",{method:"POST",data:{...e,comment:n}})}static async tableViewThreads(e,n,o){return I("/-/datasette-comments/threads/table_view",{method:"POST",data:{database:e,table:n,rowids:o}})}static async threadMarkResolved(e){return I("/-/datasette-comments/threads/mark_resolved",{method:"POST",data:{thread_id:e}})}static async threadComments(e){return I(`/-/datasette-comments/thread/comments/${e}`)}static async commentAdd(e,n){return I("/-/datasette-comments/thread/comment/add",{method:"POST",data:{thread_id:e,contents:n}})}};function Ue(t){let{comment:e}=t;return f("div",{class:"datasette-comments-comment"},f("div",{style:"display: grid; grid-template-columns: 30px auto;"},f("div",null,f("img",{width:"25px",src:e.author_profile_picture,style:"border-radius: 50%"})),f("div",{style:"line-height: .9rem;"},f("strong",null,e.author_name),f("div",{style:"font-size: .8rem"},e.created_at))),f("div",{style:{margin:".25rem .5rem"}},e.render_nodes.map(n=>{switch(n.node_type){case"raw":return f("span",null,n.value);case"mention":return f("span",{class:"mention"},f("a",{href:"#TODO"},n.value));case"tag":return f("span",{class:"tag"},f("a",{href:"#TODO"},n.value));case"url":return f("span",{class:"url"},f("a",{href:n.value,target:"_no"},n.value))}})),f("button",{class:"datasette-comments-add-reaction",dangerouslySetInnerHTML:{__html:A.ADD_REACTION}}))}function Fe(t){let[e,n]=S("");function o(){n("")}function i(){t.onSubmitted(e),n("")}return f("div",{class:"datasette-comments-draft"},f("div",{style:"display: flex;"},f("div",{style:"padding: 4px;"},f("img",{src:"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='24' height='24' fill='%23B400E1'/%3E%3Cpath d='M9.86009 16H8.75213L11.9567 7.27273H13.0476L16.2521 16H15.1442L12.5362 8.65341H12.468L9.86009 16ZM10.2692 12.5909H14.7351V13.5284H10.2692V12.5909Z' fill='white'/%3E%3C/svg%3E%0A"})),f("div",{style:"width: 100%;"},f("textarea",{onInput:_=>{let a=_.target;n(a.value),a.style.height="",a.style.height=a.scrollHeight+"px"},value:e}))),f("div",{class:"draft-bottom-drawer"},f("div",null,f("button",{class:"draft-cancel-button",onClick:o},"Cancel"),f("button",{class:"draft-add-button",onClick:i,disabled:e===""},"Add comment"))))}function qe(t){let[e,n]=S(!0),[o,i]=S(t.initialId||null),[_,a]=S([]);function c(){o!==null&&t.onRefreshComments(o).then(u=>a([...u]))}z(()=>{c()},[o,a]);function l(u){o===null?t.onNewThread(u).then(r=>i(r)).catch(()=>{}):t.onSubmitComment(o,u).then(()=>c()).catch(()=>{})}function m(){t.onMarkResolved(o).then(()=>{}).catch(()=>{})}return f("div",{className:"datasette-comments-thread"},f("div",{className:"datasette-comments-thread-meta"},o!==null&&f("button",{class:"mark-resolved-button",onClick:()=>m()},"Mark as resolved")),f("div",{className:"datasette-comments-thread-comments"},_.map(u=>f(Ue,{comment:u}))),f("div",null,f(Fe,{onSubmitted:l})))}var oe;function Be(t,e,n){let o=document.createElement("span");Object.assign(o.style,{cursor:"pointer"}),o.innerHTML=e?A.COMMENT:A.COMMENT_ADD,o.addEventListener("click",()=>{n(o)}),t.appendChild(o)}function Se(t){let{attachTo:e}=t,[n,o]=S(!0);console.log("show",n),z(()=>{o(!0);function m(u){u.key==="Escape"&&o(!1)}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[t.initialId]);async function i(m){return H.threadComments(m).then(u=>u.data)}async function _(m){return H.threadNew(t.target,m).then(({thread_id:u})=>u)}async function a(m,u){return H.commentAdd(m,u).then(()=>!0)}async function c(m){return H.threadMarkResolved(m).then(()=>!0)}let l=`translate(${e.offsetLeft+e.offsetWidth+30}px, ${e.offsetTop}px`;return f("div",null,f("div",{style:{position:"absolute",inset:"0px auto auto 0px",transform:l}},n&&f(qe,{initialId:t.initialId,marked_resolved:t.marked_resolved,onRefreshComments:i,onNewThread:_,onSubmitComment:a,onMarkResolved:c})))}function We(){let t=[],e=[];for(let n of document.querySelectorAll("tbody td.type-pk")){let o=n.querySelector("a").getAttribute("href"),[i]=o.split("/").slice(-1);t.push(i),e.push({pkEncoded:i,td:n})}return e}async function $e(t,e){let n=We(),o=await H.tableViewThreads(t,e,n.map(_=>_.pkEncoded)),i=new Map(o.data.row_threads.map(_=>[_.rowids,_.id]));Be(document.querySelector("h1"),o.data.table_threads.length>0,_=>{Y(f(Se,{attachTo:_,target:{type:"table",database:t,table:e},initialId:o.data.table_threads?.[0]?.id,marked_resolved:!1}),oe)});for(let{td:_,pkEncoded:a}of n){let c=i.get(a)??null,l=document.createElement("span"),m=document.createElement("button");m.innerText=c===null?"Comment":"Comment +",l.appendChild(m),_.appendChild(l),m.addEventListener("click",()=>{console.log(a),Y(f(Se,{attachTo:_,target:{type:"row",database:t,table:e,rowids:a},initialId:c,marked_resolved:!1}),oe)})}}function je(){oe=document.body.appendChild(document.createElement("div"));let t=window.DATASETTE_COMMENTS_META;switch(console.log(t),t.view_name){case"index":break;case"database":break;case"table":t.database&&t.table&&$e(t.database,t.table);break;case"row":break}}document.addEventListener("DOMContentLoaded",je);
