var F,f,le,Me,q,re,ce,G,Pe,N={},ue=[],Ne=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,J=Array.isArray;function x(t,e){for(var n in e)t[n]=e[n];return t}function de(t){var e=t.parentNode;e&&e.removeChild(t)}function d(t,e,n){var o,i,_,a={};for(_ in e)_=="key"?o=e[_]:_=="ref"?i=e[_]:a[_]=e[_];if(arguments.length>2&&(a.children=arguments.length>3?F.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(_ in t.defaultProps)a[_]===void 0&&(a[_]=t.defaultProps[_]);return R(t,a,o,i,null)}function R(t,e,n,o,i){var _={type:t,props:e,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++le};return i==null&&f.vnode!=null&&f.vnode(_),_}function B(t){return t.children}function V(t,e){this.props=t,this.context=e}function A(t,e){if(e==null)return t.__?A(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?A(t):null}function fe(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return fe(t)}}function _e(t){(!t.__d&&(t.__d=!0)&&q.push(t)&&!Z.__r++||re!==f.debounceRendering)&&((re=f.debounceRendering)||ce)(Z)}function Z(){var t,e,n,o,i,_,a,u,s;for(q.sort(G);t=q.shift();)t.__d&&(e=q.length,o=void 0,i=void 0,_=void 0,u=(a=(n=t).__v).__e,(s=n.__P)&&(o=[],i=[],(_=x({},a)).__v=a.__v+1,Q(s,a,_,n.__n,s.ownerSVGElement!==void 0,a.__h!=null?[u]:null,o,u??A(a),a.__h,i),ve(o,a,i),a.__e!=u&&fe(a)),q.length>e&&q.sort(G));Z.__r=0}function me(t,e,n,o,i,_,a,u,s,p,c){var r,v,m,l,h,M,g,b,k,w=0,T=o&&o.__k||ue,D=T.length,E=D,P=e.length;for(n.__k=[],r=0;r<P;r++)(l=n.__k[r]=(l=e[r])==null||typeof l=="boolean"||typeof l=="function"?null:typeof l=="string"||typeof l=="number"||typeof l=="bigint"?R(null,l,null,null,l):J(l)?R(B,{children:l},null,null,null):l.__b>0?R(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l)!=null?(l.__=n,l.__b=n.__b+1,(b=De(l,T,g=r+w,E))===-1?m=N:(m=T[b]||N,T[b]=void 0,E--),Q(t,l,m,i,_,a,u,s,p,c),h=l.__e,(v=l.ref)&&m.ref!=v&&(m.ref&&X(m.ref,null,l),c.push(v,l.__c||h,l)),h!=null&&(M==null&&(M=h),(k=m===N||m.__v===null)?b==-1&&w--:b!==g&&(b===g+1?w++:b>g?E>P-g?w+=b-g:w--:w=b<g&&b==g-1?b-g:0),g=r+w,typeof l.type!="function"||b===g&&m.__k!==l.__k?typeof l.type=="function"||b===g&&!k?l.__d!==void 0?(s=l.__d,l.__d=void 0):s=h.nextSibling:s=pe(t,h,s):s=he(l,s,t),typeof n.type=="function"&&(n.__d=s))):(m=T[r])&&m.key==null&&m.__e&&(m.__e==s&&(s=A(m)),K(m,m,!1),T[r]=null);for(n.__e=M,r=D;r--;)T[r]!=null&&(typeof n.type=="function"&&T[r].__e!=null&&T[r].__e==n.__d&&(n.__d=T[r].__e.nextSibling),K(T[r],T[r]))}function he(t,e,n){for(var o,i=t.__k,_=0;i&&_<i.length;_++)(o=i[_])&&(o.__=t,e=typeof o.type=="function"?he(o,e,n):pe(n,o.__e,e));return e}function pe(t,e,n){return n==null||n.parentNode!==t?t.insertBefore(e,null):e==n&&e.parentNode!=null||t.insertBefore(e,n),e.nextSibling}function De(t,e,n,o){var i=t.key,_=t.type,a=n-1,u=n+1,s=e[n];if(s===null||s&&i==s.key&&_===s.type)return n;if(o>(s!=null?1:0))for(;a>=0||u<e.length;){if(a>=0){if((s=e[a])&&i==s.key&&_===s.type)return a;a--}if(u<e.length){if((s=e[u])&&i==s.key&&_===s.type)return u;u++}}return-1}function Ae(t,e,n,o,i){var _;for(_ in n)_==="children"||_==="key"||_ in e||U(t,_,null,n[_],o);for(_ in e)i&&typeof e[_]!="function"||_==="children"||_==="key"||_==="value"||_==="checked"||n[_]===e[_]||U(t,_,e[_],n[_],o)}function ie(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Ne.test(e)?n:n+"px"}function U(t,e,n,o,i){var _;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof o=="string"&&(t.style.cssText=o=""),o)for(e in o)n&&e in n||ie(t.style,e,"");if(n)for(e in n)o&&n[e]===o[e]||ie(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")_=e!==(e=e.replace(/(PointerCapture)$|Capture$/,"$1")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+_]=n,n?o||t.addEventListener(e,_?se:ae,_):t.removeEventListener(e,_?se:ae,_);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e!=="rowSpan"&&e!=="colSpan"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,n))}}function ae(t){return this.l[t.type+!1](f.event?f.event(t):t)}function se(t){return this.l[t.type+!0](f.event?f.event(t):t)}function Q(t,e,n,o,i,_,a,u,s,p){var c,r,v,m,l,h,M,g,b,k,w,T,D,E,P,C=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(s=n.__h,u=e.__e=n.__e,e.__h=null,_=[u]),(c=f.__b)&&c(e);e:if(typeof C=="function")try{if(g=e.props,b=(c=C.contextType)&&o[c.__c],k=c?b?b.props.value:c.__:o,n.__c?M=(r=e.__c=n.__c).__=r.__E:("prototype"in C&&C.prototype.render?e.__c=r=new C(g,k):(e.__c=r=new V(g,k),r.constructor=C,r.render=Ie),b&&b.sub(r),r.props=g,r.state||(r.state={}),r.context=k,r.__n=o,v=r.__d=!0,r.__h=[],r._sb=[]),r.__s==null&&(r.__s=r.state),C.getDerivedStateFromProps!=null&&(r.__s==r.state&&(r.__s=x({},r.__s)),x(r.__s,C.getDerivedStateFromProps(g,r.__s))),m=r.props,l=r.state,r.__v=e,v)C.getDerivedStateFromProps==null&&r.componentWillMount!=null&&r.componentWillMount(),r.componentDidMount!=null&&r.__h.push(r.componentDidMount);else{if(C.getDerivedStateFromProps==null&&g!==m&&r.componentWillReceiveProps!=null&&r.componentWillReceiveProps(g,k),!r.__e&&(r.shouldComponentUpdate!=null&&r.shouldComponentUpdate(g,r.__s,k)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(r.props=g,r.state=r.__s,r.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(O){O&&(O.__=e)}),w=0;w<r._sb.length;w++)r.__h.push(r._sb[w]);r._sb=[],r.__h.length&&a.push(r);break e}r.componentWillUpdate!=null&&r.componentWillUpdate(g,r.__s,k),r.componentDidUpdate!=null&&r.__h.push(function(){r.componentDidUpdate(m,l,h)})}if(r.context=k,r.props=g,r.__P=t,r.__e=!1,T=f.__r,D=0,"prototype"in C&&C.prototype.render){for(r.state=r.__s,r.__d=!1,T&&T(e),c=r.render(r.props,r.state,r.context),E=0;E<r._sb.length;E++)r.__h.push(r._sb[E]);r._sb=[]}else do r.__d=!1,T&&T(e),c=r.render(r.props,r.state,r.context),r.state=r.__s;while(r.__d&&++D<25);r.state=r.__s,r.getChildContext!=null&&(o=x(x({},o),r.getChildContext())),v||r.getSnapshotBeforeUpdate==null||(h=r.getSnapshotBeforeUpdate(m,l)),me(t,J(P=c!=null&&c.type===B&&c.key==null?c.props.children:c)?P:[P],e,n,o,i,_,a,u,s,p),r.base=e.__e,e.__h=null,r.__h.length&&a.push(r),M&&(r.__E=r.__=null)}catch(O){e.__v=null,(s||_!=null)&&(e.__e=u,e.__h=!!s,_[_.indexOf(u)]=null),f.__e(O,e,n)}else _==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Le(n.__e,e,n,o,i,_,a,s,p);(c=f.diffed)&&c(e)}function ve(t,e,n){for(var o=0;o<n.length;o++)X(n[o],n[++o],n[++o]);f.__c&&f.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(_){_.call(i)})}catch(_){f.__e(_,i.__v)}})}function Le(t,e,n,o,i,_,a,u,s){var p,c,r,v=n.props,m=e.props,l=e.type,h=0;if(l==="svg"&&(i=!0),_!=null){for(;h<_.length;h++)if((p=_[h])&&"setAttribute"in p==!!l&&(l?p.localName===l:p.nodeType===3)){t=p,_[h]=null;break}}if(t==null){if(l===null)return document.createTextNode(m);t=i?document.createElementNS("http://www.w3.org/2000/svg",l):document.createElement(l,m.is&&m),_=null,u=!1}if(l===null)v===m||u&&t.data===m||(t.data=m);else{if(_=_&&F.call(t.childNodes),c=(v=n.props||N).dangerouslySetInnerHTML,r=m.dangerouslySetInnerHTML,!u){if(_!=null)for(v={},h=0;h<t.attributes.length;h++)v[t.attributes[h].name]=t.attributes[h].value;(r||c)&&(r&&(c&&r.__html==c.__html||r.__html===t.innerHTML)||(t.innerHTML=r&&r.__html||""))}if(Ae(t,m,v,i,u),r)e.__k=[];else if(me(t,J(h=e.props.children)?h:[h],e,n,o,i&&l!=="foreignObject",_,a,_?_[0]:n.__k&&A(n,0),u,s),_!=null)for(h=_.length;h--;)_[h]!=null&&de(_[h]);u||("value"in m&&(h=m.value)!==void 0&&(h!==t.value||l==="progress"&&!h||l==="option"&&h!==v.value)&&U(t,"value",h,v.value,!1),"checked"in m&&(h=m.checked)!==void 0&&h!==t.checked&&U(t,"checked",h,v.checked,!1))}return t}function X(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(o){f.__e(o,n)}}function K(t,e,n){var o,i;if(f.unmount&&f.unmount(t),(o=t.ref)&&(o.current&&o.current!==t.__e||X(o,null,e)),(o=t.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(_){f.__e(_,e)}o.base=o.__P=null,t.__c=void 0}if(o=t.__k)for(i=0;i<o.length;i++)o[i]&&K(o[i],e,n||typeof t.type!="function");n||t.__e==null||de(t.__e),t.__=t.__e=t.__d=void 0}function Ie(t,e,n){return this.constructor(t,n)}function Y(t,e,n){var o,i,_,a;f.__&&f.__(t,e),i=(o=typeof n=="function")?null:n&&n.__k||e.__k,_=[],a=[],Q(e,t=(!o&&n||e).__k=d(B,null,[t]),i||N,N,e.ownerSVGElement!==void 0,!o&&n?[n]:i?null:e.firstChild?F.call(e.childNodes):null,_,!o&&n?n:i?i.__e:e.firstChild,o,a),ve(_,t,a)}F=ue.slice,f={__e:function(t,e,n,o){for(var i,_,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((_=i.constructor)&&_.getDerivedStateFromError!=null&&(i.setState(_.getDerivedStateFromError(t)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,o||{}),a=i.__d),a)return i.__E=i}catch(u){t=u}throw t}},le=0,Me=function(t){return t!=null&&t.constructor===void 0},V.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=x({},this.state),typeof t=="function"&&(t=t(x({},n),this.props)),t&&x(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),_e(this))},V.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),_e(this))},V.prototype.render=B,q=[],ce=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,G=function(t,e){return t.__v.__b-e.__v.__b},Z.__r=0,Pe=0;var L={COMMENT_ADD:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M440-400h80v-120h120v-80H520v-120h-80v120H320v80h120v120ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>',CHECK_CIRCLE:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',ADD_REACTION:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-480Zm0 400q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q43 0 83 8.5t77 24.5v90q-35-20-75.5-31.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160q133 0 226.5-93.5T800-480q0-32-6.5-62T776-600h86q9 29 13.5 58.5T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm320-600v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM620-520q25 0 42.5-17.5T680-580q0-25-17.5-42.5T620-640q-25 0-42.5 17.5T560-580q0 25 17.5 42.5T620-520Zm-280 0q25 0 42.5-17.5T400-580q0-25-17.5-42.5T340-640q-25 0-42.5 17.5T280-580q0 25 17.5 42.5T340-520Zm140 260q68 0 123.5-38.5T684-400H276q25 63 80.5 101.5T480-260Z"/></svg>',COMMENT:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>'};var j,y,ee,ge,te=0,Ee=[],W=[],ye=f.__b,be=f.__r,Te=f.diffed,we=f.__c,Ce=f.unmount;function xe(t,e){f.__h&&f.__h(y,t,te||e),te=0;var n=y.__H||(y.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:W}),n.__[t]}function S(t){return te=1,Oe(He,t)}function Oe(t,e,n){var o=xe(j++,2);if(o.t=t,!o.__c&&(o.__=[n?n(e):He(void 0,e),function(u){var s=o.__N?o.__N[0]:o.__[0],p=o.t(s,u);s!==p&&(o.__N=[p,o.__[1]],o.__c.setState({}))}],o.__c=y,!y.u)){var i=function(u,s,p){if(!o.__c.__H)return!0;var c=o.__c.__H.__.filter(function(v){return v.__c});if(c.every(function(v){return!v.__N}))return!_||_.call(this,u,s,p);var r=!1;return c.forEach(function(v){if(v.__N){var m=v.__[0];v.__=v.__N,v.__N=void 0,m!==v.__[0]&&(r=!0)}}),!(!r&&o.__c.props===u)&&(!_||_.call(this,u,s,p))};y.u=!0;var _=y.shouldComponentUpdate,a=y.componentWillUpdate;y.componentWillUpdate=function(u,s,p){if(this.__e){var c=_;_=void 0,i(u,s,p),_=c}a&&a.call(this,u,s,p)},y.shouldComponentUpdate=i}return o.__N||o.__}function z(t,e){var n=xe(j++,3);!f.__s&&Ze(n.__H,e)&&(n.__=t,n.i=e,y.__H.__h.push(n))}function Re(){for(var t;t=Ee.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach($),t.__H.__h.forEach(ne),t.__H.__h=[]}catch(e){t.__H.__h=[],f.__e(e,t.__v)}}f.__b=function(t){y=null,ye&&ye(t)},f.__r=function(t){be&&be(t),j=0;var e=(y=t.__c).__H;e&&(ee===y?(e.__h=[],y.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=W,n.__N=n.i=void 0})):(e.__h.forEach($),e.__h.forEach(ne),e.__h=[],j=0)),ee=y},f.diffed=function(t){Te&&Te(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ee.push(e)!==1&&ge===f.requestAnimationFrame||((ge=f.requestAnimationFrame)||Ve)(Re)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==W&&(n.__=n.__V),n.i=void 0,n.__V=W})),ee=y=null},f.__c=function(t,e){e.some(function(n){try{n.__h.forEach($),n.__h=n.__h.filter(function(o){return!o.__||ne(o)})}catch(o){e.some(function(i){i.__h&&(i.__h=[])}),e=[],f.__e(o,n.__v)}}),we&&we(t,e)},f.unmount=function(t){Ce&&Ce(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{$(o)}catch(i){e=i}}),n.__H=void 0,e&&f.__e(e,n.__v))};var ke=typeof requestAnimationFrame=="function";function Ve(t){var e,n=function(){clearTimeout(o),ke&&cancelAnimationFrame(e),setTimeout(t)},o=setTimeout(n,100);ke&&(e=requestAnimationFrame(n))}function $(t){var e=y,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),y=e}function ne(t){var e=y;t.__c=t.__(),y=e}function Ze(t,e){return!t||t.length!==e.length||e.some(function(n,o){return n!==t[o]})}function He(t,e){return typeof e=="function"?e(t):e}async function I(t,e){let{method:n,data:o}=e??{};return fetch(`${t}`,{method:n,credentials:"include",headers:{"Content-Type":"application/json"},body:o?JSON.stringify(o):void 0}).then(i=>i.json())}var H=class{static async threadNew(e,n){return I("/-/datasette-comments/thread/new",{method:"POST",data:{...e,comment:n}})}static async tableViewThreads(e,n,o){return I("/-/datasette-comments/threads/table_view",{method:"POST",data:{database:e,table:n,rowids:o}})}static async threadMarkResolved(e){return I("/-/datasette-comments/threads/mark_resolved",{method:"POST",data:{thread_id:e}})}static async threadComments(e){return I(`/-/datasette-comments/thread/comments/${e}`)}static async commentAdd(e,n){return I("/-/datasette-comments/thread/comment/add",{method:"POST",data:{thread_id:e,contents:n}})}};function Ue(t){let{comment:e}=t;return d("div",{class:"datasette-comments-comment"},d("div",{style:"display: grid; grid-template-columns: 30px auto;"},d("div",null,d("img",{width:"25px",src:e.author_profile_picture,style:"border-radius: 50%"})),d("div",{style:"line-height: .9rem;"},d("strong",null,e.author_name),d("div",{style:"font-size: .8rem"},e.created_at))),d("div",{style:{margin:".25rem .5rem"}},e.render_nodes.map(n=>{switch(n.node_type){case"linebreak":return d("br",null);case"raw":return d("span",null,n.value);case"mention":return d("span",{class:"mention"},d("a",{href:"#TODO"},n.value));case"tag":return d("span",{class:"tag"},d("a",{href:"#TODO"},n.value));case"url":return d("span",{class:"url"},d("a",{href:n.value,target:"_no"},n.value))}})),d("button",{class:"datasette-comments-add-reaction",dangerouslySetInnerHTML:{__html:L.ADD_REACTION}}))}function Fe(t){let[e,n]=S("");function o(){n("")}function i(){t.onSubmitted(e),n("")}return d("div",{class:"datasette-comments-draft"},d("div",{style:"display: flex;"},d("div",{style:"padding: 4px;"},d("img",{src:"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='24' height='24' fill='%23B400E1'/%3E%3Cpath d='M9.86009 16H8.75213L11.9567 7.27273H13.0476L16.2521 16H15.1442L12.5362 8.65341H12.468L9.86009 16ZM10.2692 12.5909H14.7351V13.5284H10.2692V12.5909Z' fill='white'/%3E%3C/svg%3E%0A"})),d("div",{style:"width: 100%;"},d("textarea",{onInput:_=>{let a=_.target;n(a.value),a.style.height="",a.style.height=a.scrollHeight+"px"},value:e}))),d("div",{class:"draft-bottom-drawer"},d("div",null,d("button",{class:"draft-cancel-button",onClick:o},"Cancel"),d("button",{class:"draft-add-button",onClick:i,disabled:e===""},"Add comment"))))}function qe(t){let[e,n]=S(!0),[o,i]=S(t.initialId||null),[_,a]=S([]);function u(){o!==null&&t.onRefreshComments(o).then(c=>a([...c]))}z(()=>{u()},[o,a]);function s(c){o===null?t.onNewThread(c).then(r=>i(r)).catch(()=>{}):t.onSubmitComment(o,c).then(()=>u()).catch(()=>{})}function p(){t.onMarkResolved(o).then(()=>{}).catch(()=>{})}return d("div",{className:"datasette-comments-thread"},d("div",{className:"datasette-comments-thread-meta"},o!==null&&d("button",{class:"mark-resolved-button",onClick:()=>p()},"Mark as resolved")),d("div",{className:"datasette-comments-thread-comments"},_.map(c=>d(Ue,{comment:c}))),d("div",null,d(Fe,{onSubmitted:s})))}var oe;function Be(t,e,n){let o=document.createElement("span");Object.assign(o.style,{cursor:"pointer"}),o.innerHTML=e?L.COMMENT:L.COMMENT_ADD,o.addEventListener("click",()=>{n(o)}),t.appendChild(o)}function Se(t){let{attachTo:e}=t,[n,o]=S(!0);console.log("show",n),z(()=>{o(!0);function c(r){r.key==="Escape"&&o(!1)}return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[t.initialId]);async function i(c){return H.threadComments(c).then(r=>r.data)}async function _(c){return H.threadNew(t.target,c).then(({thread_id:r})=>r)}async function a(c,r){return H.commentAdd(c,r).then(()=>!0)}async function u(c){return H.threadMarkResolved(c).then(()=>!0)}let s=e.getBoundingClientRect(),p=`translate(${s.left+e.offsetWidth+10}px, ${s.top}px`;return d("div",null,d("div",{style:{position:"absolute",inset:"0px auto auto 0px",transform:p}},n&&d(qe,{initialId:t.initialId,marked_resolved:t.marked_resolved,onRefreshComments:i,onNewThread:_,onSubmitComment:a,onMarkResolved:u})))}function We(){let t=[],e=[];for(let n of document.querySelectorAll("tbody td.type-pk")){let o=n.querySelector("a").getAttribute("href"),[i]=o.split("/").slice(-1);t.push(i),e.push({pkEncoded:i,td:n})}return e}async function $e(t,e){let n=We(),o=await H.tableViewThreads(t,e,n.map(_=>_.pkEncoded)),i=new Map(o.data.row_threads.map(_=>[_.rowids,_.id]));Be(document.querySelector("h1"),o.data.table_threads.length>0,_=>{Y(d(Se,{attachTo:_,target:{type:"table",database:t,table:e},initialId:o.data.table_threads?.[0]?.id,marked_resolved:!1}),oe)});for(let{td:_,pkEncoded:a}of n){let u=i.get(a)??null,s=document.createElement("span"),p=document.createElement("button");p.innerText=u===null?"Comment":"Comment +",s.appendChild(p),_.appendChild(s),p.addEventListener("click",()=>{console.log(a),Y(d(Se,{attachTo:_,target:{type:"row",database:t,table:e,rowids:a},initialId:u,marked_resolved:!1}),oe)})}}function je(){oe=document.body.appendChild(document.createElement("div"));let t=window.DATASETTE_COMMENTS_META;switch(console.log(t),t.view_name){case"index":break;case"database":break;case"table":t.database&&t.table&&$e(t.database,t.table);break;case"row":break}}document.addEventListener("DOMContentLoaded",je);
