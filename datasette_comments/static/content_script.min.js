var Be=Object.create;var me=Object.defineProperty;var je=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var ze=Object.getPrototypeOf,Ke=Object.prototype.hasOwnProperty;var Je=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ye=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ge(e))!Ke.call(t,i)&&i!==n&&me(t,i,{get:()=>e[i],enumerable:!(o=je(e,i))||o.enumerable});return t};var Qe=(t,e,n)=>(n=t!=null?Be(ze(t)):{},Ye(e||!t||!t.__esModule?me(n,"default",{value:t,enumerable:!0}):n,t));var Fe=Je((xt,Ue)=>{var O=1e3,I=O*60,V=I*60,A=V*24,_t=A*7,ct=A*365.25;Ue.exports=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return lt(t);if(n==="number"&&isFinite(t))return e.long?dt(t):ut(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function lt(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*ct;case"weeks":case"week":case"w":return n*_t;case"days":case"day":case"d":return n*A;case"hours":case"hour":case"hrs":case"hr":case"h":return n*V;case"minutes":case"minute":case"mins":case"min":case"m":return n*I;case"seconds":case"second":case"secs":case"sec":case"s":return n*O;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function ut(t){var e=Math.abs(t);return e>=A?Math.round(t/A)+"d":e>=V?Math.round(t/V)+"h":e>=I?Math.round(t/I)+"m":e>=O?Math.round(t/O)+"s":t+"ms"}function dt(t){var e=Math.abs(t);return e>=A?X(t,e,A,"day"):e>=V?X(t,e,V,"hour"):e>=I?X(t,e,I,"minute"):e>=O?X(t,e,O,"second"):t+" ms"}function X(t,e,n,o){var i=e>=n*1.5;return Math.round(t/n)+" "+o+(i?"s":"")}});var z,m,ye,Xe,N,pe,be,te,Te,R={},we=[],et=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,oe=Array.isArray;function M(t,e){for(var n in e)t[n]=e[n];return t}function ke(t){var e=t.parentNode;e&&e.removeChild(t)}function d(t,e,n){var o,i,a,c={};for(a in e)a=="key"?o=e[a]:a=="ref"?i=e[a]:c[a]=e[a];if(arguments.length>2&&(c.children=arguments.length>3?z.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)c[a]===void 0&&(c[a]=t.defaultProps[a]);return W(t,c,o,i,null)}function W(t,e,n,o,i){var a={type:t,props:e,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++ye};return i==null&&m.vnode!=null&&m.vnode(a),a}function K(t){return t.children}function B(t,e){this.props=t,this.context=e}function F(t,e){if(e==null)return t.__?F(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?F(t):null}function Ce(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Ce(t)}}function ne(t){(!t.__d&&(t.__d=!0)&&N.push(t)&&!j.__r++||pe!==m.debounceRendering)&&((pe=m.debounceRendering)||be)(j)}function j(){var t,e,n,o,i,a,c,s,l;for(N.sort(te);t=N.shift();)t.__d&&(e=N.length,o=void 0,i=void 0,a=void 0,s=(c=(n=t).__v).__e,(l=n.__P)&&(o=[],i=[],(a=M({},c)).__v=c.__v+1,ae(l,c,a,n.__n,l.ownerSVGElement!==void 0,c.__h!=null?[s]:null,o,s??F(c),c.__h,i),Me(o,c,i),c.__e!=s&&Ce(c)),N.length>e&&N.sort(te));j.__r=0}function Ee(t,e,n,o,i,a,c,s,l,h,_){var r,p,f,u,v,L,g,b,E,w=0,T=o&&o.__k||we,U=T.length,S=U,D=e.length;for(n.__k=[],r=0;r<D;r++)(u=n.__k[r]=(u=e[r])==null||typeof u=="boolean"||typeof u=="function"?null:typeof u=="string"||typeof u=="number"||typeof u=="bigint"?W(null,u,null,null,u):oe(u)?W(K,{children:u},null,null,null):u.__b>0?W(u.type,u.props,u.key,u.ref?u.ref:null,u.__v):u)!=null?(u.__=n,u.__b=n.__b+1,(b=tt(u,T,g=r+w,S))===-1?f=R:(f=T[b]||R,T[b]=void 0,S--),ae(t,u,f,i,a,c,s,l,h,_),v=u.__e,(p=u.ref)&&f.ref!=p&&(f.ref&&ie(f.ref,null,u),_.push(p,u.__c||v,u)),v!=null&&(L==null&&(L=v),(E=f===R||f.__v===null)?b==-1&&w--:b!==g&&(b===g+1?w++:b>g?S>D-g?w+=b-g:w--:w=b<g&&b==g-1?b-g:0),g=r+w,typeof u.type!="function"||b===g&&f.__k!==u.__k?typeof u.type=="function"||b===g&&!E?u.__d!==void 0?(l=u.__d,u.__d=void 0):l=v.nextSibling:l=Se(t,v,l):l=xe(u,l,t),typeof n.type=="function"&&(n.__d=l))):(f=T[r])&&f.key==null&&f.__e&&(f.__e==l&&(l=F(f)),re(f,f,!1),T[r]=null);for(n.__e=L,r=U;r--;)T[r]!=null&&(typeof n.type=="function"&&T[r].__e!=null&&T[r].__e==n.__d&&(n.__d=T[r].__e.nextSibling),re(T[r],T[r]))}function xe(t,e,n){for(var o,i=t.__k,a=0;i&&a<i.length;a++)(o=i[a])&&(o.__=t,e=typeof o.type=="function"?xe(o,e,n):Se(n,o.__e,e));return e}function Se(t,e,n){return n==null||n.parentNode!==t?t.insertBefore(e,null):e==n&&e.parentNode!=null||t.insertBefore(e,n),e.nextSibling}function tt(t,e,n,o){var i=t.key,a=t.type,c=n-1,s=n+1,l=e[n];if(l===null||l&&i==l.key&&a===l.type)return n;if(o>(l!=null?1:0))for(;c>=0||s<e.length;){if(c>=0){if((l=e[c])&&i==l.key&&a===l.type)return c;c--}if(s<e.length){if((l=e[s])&&i==l.key&&a===l.type)return s;s++}}return-1}function nt(t,e,n,o,i){var a;for(a in n)a==="children"||a==="key"||a in e||G(t,a,null,n[a],o);for(a in e)i&&typeof e[a]!="function"||a==="children"||a==="key"||a==="value"||a==="checked"||n[a]===e[a]||G(t,a,e[a],n[a],o)}function he(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||et.test(e)?n:n+"px"}function G(t,e,n,o,i){var a;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof o=="string"&&(t.style.cssText=o=""),o)for(e in o)n&&e in n||he(t.style,e,"");if(n)for(e in n)o&&n[e]===o[e]||he(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")a=e!==(e=e.replace(/(PointerCapture)$|Capture$/,"$1")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=n,n?o||t.addEventListener(e,a?ge:ve,a):t.removeEventListener(e,a?ge:ve,a);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e!=="rowSpan"&&e!=="colSpan"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,n))}}function ve(t){return this.l[t.type+!1](m.event?m.event(t):t)}function ge(t){return this.l[t.type+!0](m.event?m.event(t):t)}function ae(t,e,n,o,i,a,c,s,l,h){var _,r,p,f,u,v,L,g,b,E,w,T,U,S,D,k=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(l=n.__h,s=e.__e=n.__e,e.__h=null,a=[s]),(_=m.__b)&&_(e);e:if(typeof k=="function")try{if(g=e.props,b=(_=k.contextType)&&o[_.__c],E=_?b?b.props.value:_.__:o,n.__c?L=(r=e.__c=n.__c).__=r.__E:("prototype"in k&&k.prototype.render?e.__c=r=new k(g,E):(e.__c=r=new B(g,E),r.constructor=k,r.render=ot),b&&b.sub(r),r.props=g,r.state||(r.state={}),r.context=E,r.__n=o,p=r.__d=!0,r.__h=[],r._sb=[]),r.__s==null&&(r.__s=r.state),k.getDerivedStateFromProps!=null&&(r.__s==r.state&&(r.__s=M({},r.__s)),M(r.__s,k.getDerivedStateFromProps(g,r.__s))),f=r.props,u=r.state,r.__v=e,p)k.getDerivedStateFromProps==null&&r.componentWillMount!=null&&r.componentWillMount(),r.componentDidMount!=null&&r.__h.push(r.componentDidMount);else{if(k.getDerivedStateFromProps==null&&g!==f&&r.componentWillReceiveProps!=null&&r.componentWillReceiveProps(g,E),!r.__e&&(r.shouldComponentUpdate!=null&&r.shouldComponentUpdate(g,r.__s,E)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(r.props=g,r.state=r.__s,r.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function($){$&&($.__=e)}),w=0;w<r._sb.length;w++)r.__h.push(r._sb[w]);r._sb=[],r.__h.length&&c.push(r);break e}r.componentWillUpdate!=null&&r.componentWillUpdate(g,r.__s,E),r.componentDidUpdate!=null&&r.__h.push(function(){r.componentDidUpdate(f,u,v)})}if(r.context=E,r.props=g,r.__P=t,r.__e=!1,T=m.__r,U=0,"prototype"in k&&k.prototype.render){for(r.state=r.__s,r.__d=!1,T&&T(e),_=r.render(r.props,r.state,r.context),S=0;S<r._sb.length;S++)r.__h.push(r._sb[S]);r._sb=[]}else do r.__d=!1,T&&T(e),_=r.render(r.props,r.state,r.context),r.state=r.__s;while(r.__d&&++U<25);r.state=r.__s,r.getChildContext!=null&&(o=M(M({},o),r.getChildContext())),p||r.getSnapshotBeforeUpdate==null||(v=r.getSnapshotBeforeUpdate(f,u)),Ee(t,oe(D=_!=null&&_.type===K&&_.key==null?_.props.children:_)?D:[D],e,n,o,i,a,c,s,l,h),r.base=e.__e,e.__h=null,r.__h.length&&c.push(r),L&&(r.__E=r.__=null)}catch($){e.__v=null,(l||a!=null)&&(e.__e=s,e.__h=!!l,a[a.indexOf(s)]=null),m.__e($,e,n)}else a==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=rt(n.__e,e,n,o,i,a,c,l,h);(_=m.diffed)&&_(e)}function Me(t,e,n){for(var o=0;o<n.length;o++)ie(n[o],n[++o],n[++o]);m.__c&&m.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(a){a.call(i)})}catch(a){m.__e(a,i.__v)}})}function rt(t,e,n,o,i,a,c,s,l){var h,_,r,p=n.props,f=e.props,u=e.type,v=0;if(u==="svg"&&(i=!0),a!=null){for(;v<a.length;v++)if((h=a[v])&&"setAttribute"in h==!!u&&(u?h.localName===u:h.nodeType===3)){t=h,a[v]=null;break}}if(t==null){if(u===null)return document.createTextNode(f);t=i?document.createElementNS("http://www.w3.org/2000/svg",u):document.createElement(u,f.is&&f),a=null,s=!1}if(u===null)p===f||s&&t.data===f||(t.data=f);else{if(a=a&&z.call(t.childNodes),_=(p=n.props||R).dangerouslySetInnerHTML,r=f.dangerouslySetInnerHTML,!s){if(a!=null)for(p={},v=0;v<t.attributes.length;v++)p[t.attributes[v].name]=t.attributes[v].value;(r||_)&&(r&&(_&&r.__html==_.__html||r.__html===t.innerHTML)||(t.innerHTML=r&&r.__html||""))}if(nt(t,f,p,i,s),r)e.__k=[];else if(Ee(t,oe(v=e.props.children)?v:[v],e,n,o,i&&u!=="foreignObject",a,c,a?a[0]:n.__k&&F(n,0),s,l),a!=null)for(v=a.length;v--;)a[v]!=null&&ke(a[v]);s||("value"in f&&(v=f.value)!==void 0&&(v!==t.value||u==="progress"&&!v||u==="option"&&v!==p.value)&&G(t,"value",v,p.value,!1),"checked"in f&&(v=f.checked)!==void 0&&v!==t.checked&&G(t,"checked",v,p.checked,!1))}return t}function ie(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(o){m.__e(o,n)}}function re(t,e,n){var o,i;if(m.unmount&&m.unmount(t),(o=t.ref)&&(o.current&&o.current!==t.__e||ie(o,null,e)),(o=t.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(a){m.__e(a,e)}o.base=o.__P=null,t.__c=void 0}if(o=t.__k)for(i=0;i<o.length;i++)o[i]&&re(o[i],e,n||typeof t.type!="function");n||t.__e==null||ke(t.__e),t.__=t.__e=t.__d=void 0}function ot(t,e,n){return this.constructor(t,n)}function J(t,e,n){var o,i,a,c;m.__&&m.__(t,e),i=(o=typeof n=="function")?null:n&&n.__k||e.__k,a=[],c=[],ae(e,t=(!o&&n||e).__k=d(K,null,[t]),i||R,R,e.ownerSVGElement!==void 0,!o&&n?[n]:i?null:e.firstChild?z.call(e.childNodes):null,a,!o&&n?n:i?i.__e:e.firstChild,o,c),Me(a,t,c)}function He(t,e){var n={__c:e="__cC"+Te++,__:t,Consumer:function(o,i){return o.children(i)},Provider:function(o){var i,a;return this.getChildContext||(i=[],(a={})[e]=this,this.getChildContext=function(){return a},this.shouldComponentUpdate=function(c){this.props.value!==c.value&&i.some(function(s){s.__e=!0,ne(s)})},this.sub=function(c){i.push(c);var s=c.componentWillUnmount;c.componentWillUnmount=function(){i.splice(i.indexOf(c),1),s&&s.call(c)}}),o.children}};return n.Provider.__=n.Consumer.contextType=n}z=we.slice,m={__e:function(t,e,n,o){for(var i,a,c;e=e.__;)if((i=e.__c)&&!i.__)try{if((a=i.constructor)&&a.getDerivedStateFromError!=null&&(i.setState(a.getDerivedStateFromError(t)),c=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,o||{}),c=i.__d),c)return i.__E=i}catch(s){t=s}throw t}},ye=0,Xe=function(t){return t!=null&&t.constructor===void 0},B.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=M({},this.state),typeof t=="function"&&(t=t(M({},n),this.props)),t&&M(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ne(this))},B.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ne(this))},B.prototype.render=K,N=[],be=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,te=function(t,e){return t.__v.__b-e.__v.__b},j.__r=0,Te=0;var x={COMMENT_ADD:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M440-400h80v-120h120v-80H520v-120h-80v120H320v80h120v120ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>',CHECK_CIRCLE:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',ADD_REACTION:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-480Zm0 400q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q43 0 83 8.5t77 24.5v90q-35-20-75.5-31.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160q133 0 226.5-93.5T800-480q0-32-6.5-62T776-600h86q9 29 13.5 58.5T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm320-600v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM620-520q25 0 42.5-17.5T680-580q0-25-17.5-42.5T620-640q-25 0-42.5 17.5T560-580q0 25 17.5 42.5T620-520Zm-280 0q25 0 42.5-17.5T400-580q0-25-17.5-42.5T340-640q-25 0-42.5 17.5T280-580q0 25 17.5 42.5T340-520Zm140 260q68 0 123.5-38.5T684-400H276q25 63 80.5 101.5T480-260Z"/></svg>',COMMENT:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg>'};var Z,y,se,Ne,_e=0,Oe=[],Y=[],Pe=m.__b,qe=m.__r,Ae=m.diffed,Le=m.__c,De=m.unmount;function le(t,e){m.__h&&m.__h(y,t,_e||e),_e=0;var n=y.__H||(y.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:Y}),n.__[t]}function P(t){return _e=1,ue(Ie,t)}function ue(t,e,n){var o=le(Z++,2);if(o.t=t,!o.__c&&(o.__=[n?n(e):Ie(void 0,e),function(s){var l=o.__N?o.__N[0]:o.__[0],h=o.t(l,s);l!==h&&(o.__N=[h,o.__[1]],o.__c.setState({}))}],o.__c=y,!y.u)){var i=function(s,l,h){if(!o.__c.__H)return!0;var _=o.__c.__H.__.filter(function(p){return p.__c});if(_.every(function(p){return!p.__N}))return!a||a.call(this,s,l,h);var r=!1;return _.forEach(function(p){if(p.__N){var f=p.__[0];p.__=p.__N,p.__N=void 0,f!==p.__[0]&&(r=!0)}}),!(!r&&o.__c.props===s)&&(!a||a.call(this,s,l,h))};y.u=!0;var a=y.shouldComponentUpdate,c=y.componentWillUpdate;y.componentWillUpdate=function(s,l,h){if(this.__e){var _=a;a=void 0,i(s,l,h),a=_}c&&c.call(this,s,l,h)},y.shouldComponentUpdate=i}return o.__N||o.__}function q(t,e){var n=le(Z++,3);!m.__s&&st(n.__H,e)&&(n.__=t,n.i=e,y.__H.__h.push(n))}function de(t){var e=y.context[t.__c],n=le(Z++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(y)),e.props.value):t.__}function at(){for(var t;t=Oe.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Q),t.__H.__h.forEach(ce),t.__H.__h=[]}catch(e){t.__H.__h=[],m.__e(e,t.__v)}}m.__b=function(t){y=null,Pe&&Pe(t)},m.__r=function(t){qe&&qe(t),Z=0;var e=(y=t.__c).__H;e&&(se===y?(e.__h=[],y.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=Y,n.__N=n.i=void 0})):(e.__h.forEach(Q),e.__h.forEach(ce),e.__h=[],Z=0)),se=y},m.diffed=function(t){Ae&&Ae(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Oe.push(e)!==1&&Ne===m.requestAnimationFrame||((Ne=m.requestAnimationFrame)||it)(at)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==Y&&(n.__=n.__V),n.i=void 0,n.__V=Y})),se=y=null},m.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Q),n.__h=n.__h.filter(function(o){return!o.__||ce(o)})}catch(o){e.some(function(i){i.__h&&(i.__h=[])}),e=[],m.__e(o,n.__v)}}),Le&&Le(t,e)},m.unmount=function(t){De&&De(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{Q(o)}catch(i){e=i}}),n.__H=void 0,e&&m.__e(e,n.__v))};var Re=typeof requestAnimationFrame=="function";function it(t){var e,n=function(){clearTimeout(o),Re&&cancelAnimationFrame(e),setTimeout(t)},o=setTimeout(n,100);Re&&(e=requestAnimationFrame(n))}function Q(t){var e=y,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),y=e}function ce(t){var e=y;t.__c=t.__(),y=e}function st(t,e){return!t||t.length!==e.length||e.some(function(n,o){return n!==t[o]})}function Ie(t,e){return typeof e=="function"?e(t):e}async function H(t,e){let{method:n,data:o}=e??{};return fetch(`${t}`,{method:n,credentials:"include",headers:{"Content-Type":"application/json"},body:o?JSON.stringify(o):void 0}).then(i=>i.json())}var C=class{static async threadNew(e,n){return H("/-/datasette-comments/api/thread/new",{method:"POST",data:{...e,comment:n}})}static async tableViewThreads(e,n,o){return H("/-/datasette-comments/api/threads/table_view",{method:"POST",data:{database:e,table:n,rowids:o}})}static async threadMarkResolved(e){return H("/-/datasette-comments/api/threads/mark_resolved",{method:"POST",data:{thread_id:e}})}static async threadComments(e){return H(`/-/datasette-comments/api/thread/comments/${e}`)}static async commentAdd(e,n){return H("/-/datasette-comments/api/thread/comment/add",{method:"POST",data:{thread_id:e,contents:n}})}static async reactionAdd(e,n){return H("/-/datasette-comments/api/reaction/add",{method:"POST",data:{comment_id:e,reaction:n}})}static async reactionRemove(e,n){return H("/-/datasette-comments/api/reaction/remove",{method:"POST",data:{comment_id:e,reaction:n}})}static async reactions(e){return H(`/-/datasette-comments/api/reactions/${e}`)}};function Ve(t,e){switch(e.type){case"init":return{...t,isLoading:!0};case"failure":return{...t,isLoading:!1,error:e.error};case"success":return{...t,isLoading:!1,data:e.data}}}var Ze=Qe(Fe()),fe=He({author_actor_id:"",profile_photo_url:""});function ft(t){let{author_actor_id:e}=de(fe),[n,o]=P(t.initialReactions),[i,a]=P(!1);function c(){C.reactions(t.comment_id).then(_=>o(_))}function s(_){_.stopPropagation(),a(r=>!r)}function l(_){C.reactionAdd(t.comment_id,_).then(()=>c())}q(()=>{if(i){let _=function(r){let p=r.target;for(;p&&(p=p.parentElement,!p?.classList?.contains("datasette-comments-reactions")););p||a(!1)};return document.addEventListener("click",_),()=>{document.removeEventListener("click",_)}}},[i,a]);let h=new Map;for(let _ of n)h.has(_.reaction)?h.set(_.reaction,[...h.get(_.reaction),_.reactor_actor_id]):h.set(_.reaction,[_.reactor_actor_id]);return d("div",{class:"datasette-comments-reactions"},Array.from(h).map(([_,r],p)=>d("div",null,d("button",{key:p,class:"other-reactions"+(r.indexOf(e)>=0?" viewer-reacted":""),onClick:()=>{h.get(_)?.find(f=>f===e)?C.reactionRemove(t.comment_id,_).then(()=>c()):l(_)}},_," ",r.length))),d("div",null,d("button",{class:"datasette-comments-add-reaction",dangerouslySetInnerHTML:{__html:x.ADD_REACTION},onClick:s})),d("div",{style:"position:relative"},i&&d("div",{className:"popup"},["\u{1F44D}","\u{1F44E}","\u{1F600}","\u{1F615}","\u{1F389}","\u2764\uFE0F","\u{1F680}","\u{1F440}"].filter(_=>{let r=h.get(_);return r?r.indexOf(e)<0:!0}).map(_=>d("button",{key:_,onClick:r=>{r.stopPropagation(),l(_),a(!1)}},_)))))}function mt(t){let{comment:e}=t;return d("div",{class:"datasette-comments-comment"},d("div",{style:"display: grid; grid-template-columns: 30px auto;"},d("div",null,d("img",{width:"25px",src:e.author_profile_picture,style:"border-radius: 50%"})),d("div",{style:"line-height: .9rem;"},d("strong",null,e.author_name),d("div",{style:"font-size: .8rem",title:e.created_at},(0,Ze.default)(e.created_duration_seconds*1e3,{long:!0})," ago"))),d("div",{style:{margin:".25rem .5rem"}},e.render_nodes.map(n=>{switch(n.node_type){case"linebreak":return d("br",null);case"raw":return d("span",null,n.value);case"mention":return d("span",{class:"mention"},d("a",{href:"#TODO"},n.value));case"tag":return d("span",{class:"tag"},d("a",{href:`/-/datasette-comments/tags/${n.value.slice(1)}`},n.value));case"url":return d("span",{class:"url"},d("a",{href:n.value,target:"_no"},n.value))}})),d(ft,{comment_id:e.id,initialReactions:e.reactions}))}function pt(t){let{profile_photo_url:e}=de(fe),[n,o]=P("");function i(){o("")}function a(){t.onSubmitted(n),o("")}return d("div",{class:"datasette-comments-draft"},d("div",{style:"display: flex;"},d("div",{style:"padding: 4px;"},d("img",{src:e,width:"25px"})),d("div",{style:"width: 100%; display: flex;"},d("textarea",{onInput:c=>{let s=c.target;o(s.value),s.style.height="",s.style.height=s.scrollHeight+"px"},value:n}))),d("div",{class:"draft-bottom-drawer"},d("div",null,d("button",{class:"draft-cancel-button",onClick:i},"Cancel"),d("button",{class:"draft-add-button",onClick:a,disabled:n===""},"Add comment"))))}function $e(t){let[e,n]=P(t.initialId||null),[o,i]=ue(Ve,{isLoading:!1});function a(){e!==null&&(i({type:"init"}),C.threadComments(e).then(l=>{i({type:"success",data:l.data})}).catch(l=>{i({type:"failure",error:"TODO"})}))}q(()=>{n(t.initialId)},[t.initialId,n]),q(()=>{a()},[e]);function c(l){e===null?C.threadNew(t.target,l).then(({thread_id:h})=>{n(h),t.onNewThread(l)}):C.commentAdd(e,l).then(()=>a()).catch(()=>{})}function s(){C.threadMarkResolved(e).then(()=>{}).catch(()=>{})}return d(fe.Provider,{value:t.author},d("div",{className:"datasette-comments-thread"},d("div",{className:"datasette-comments-thread-meta"},e!==null&&d("button",{class:"mark-resolved-button",onClick:()=>s()},d("span",{dangerouslySetInnerHTML:{__html:x.CHECK_CIRCLE}}))),d("div",{className:"datasette-comments-thread-comments"},o.isLoading?d("div",{style:"text-align:center; margin: 1rem;"},"Loading..."):o.error?o.error:o.data?.map(l=>d(mt,{comment:l}))),d("div",null,d(pt,{onSubmitted:c}))))}var ee;function ht(t,e,n){let o=document.createElement("span");Object.assign(o.style,{cursor:"pointer"}),o.innerHTML=e?x.COMMENT:x.COMMENT_ADD,o.addEventListener("click",()=>{n(o)}),t.appendChild(o)}function We(t){let{attachTo:e}=t,[n,o]=P(!0);q(()=>{o(!0);function s(h){h.key==="Escape"&&o(!1)}function l(h){let _=h.target;for(;_&&(_=_.parentElement,!_?.classList?.contains("datasette-comments-thread-popup")););_||o(!1)}return document.addEventListener("keydown",s),document.addEventListener("click",l),()=>{document.removeEventListener("keydown",s),document.removeEventListener("click",l)}},[t.initialId,t.attachTo]),q(()=>(n?t.attachTo.style.border="1px solid red":t.attachTo.style.border="",()=>{t.attachTo.style.border=""}),[t.attachTo,n]);async function i(){t.onNewThread()}let a=e.getBoundingClientRect(),c=`translate(${a.left+e.offsetWidth+10}px, ${a.top+window.scrollY}px`;return d("div",{className:"datasette-comments-thread-popup"},d("div",{style:{position:"absolute",inset:"0px auto auto 0px",transform:c}},n&&d($e,{target:t.target,initialId:t.initialId,marked_resolved:t.marked_resolved,author:{author_actor_id:t.actor_id,profile_photo_url:t.profile_photo_url},onNewThread:i})))}function vt(){let t=[],e=[];for(let n of document.querySelectorAll("tbody td.type-pk")){let o=n.querySelector("a").getAttribute("href"),[i]=o.split("/").slice(-1);t.push(i),e.push({pkEncoded:i,td:n})}return e}async function gt(t,e,n,o){let i=vt(),a=await C.tableViewThreads(t,e,i.map(s=>s.pkEncoded)),c=new Map(a.data.row_threads.map(s=>[s.rowids,s.id]));ht(document.querySelector("h1"),a.data.table_threads.length>0,s=>{J(d(We,{attachTo:s,target:{type:"table",database:t,table:e},initialId:a.data.table_threads?.[0]?.id,marked_resolved:!1,actor_id:n,profile_photo_url:o,onNewThread:()=>{}}),ee)});for(let{td:s,pkEncoded:l}of i){let h=c.get(l)??null;s.style.position="relative";let _=document.createElement("span");Object.assign(_.style,{position:"absolute",bottom:0,right:0});let r=document.createElement("button");Object.assign(r.style,{background:"none",border:"none",cursor:"pointer"});let p=null;if(!h){let f=function(){r.style.display="block"},u=function(){r.style.display="none"};r.style.display="none",s.addEventListener("mouseenter",f),s.addEventListener("mouseleave",u),p=()=>{s.removeEventListener("mouseenter",f),s.removeEventListener("mouseleave",u)}}r.innerHTML=h?x.COMMENT:x.COMMENT_ADD,r.querySelector("svg").width=16,r.querySelector("svg").height=16,r.addEventListener("click",()=>{J(null,ee),J(d(We,{attachTo:s,target:{type:"row",database:t,table:e,rowids:l},initialId:h,marked_resolved:!1,actor_id:n,profile_photo_url:o,onNewThread:()=>{r.innerHTML=x.COMMENT,r.style.display="block",p&&p()}}),ee)}),_.appendChild(r),s.appendChild(_)}}function yt(){ee=document.body.appendChild(document.createElement("div"));let t=window.DATASETTE_COMMENTS_META;switch(t.view_name){case"index":break;case"database":break;case"table":t.database&&t.table&&gt(t.database,t.table,t.actor_id,t.profile_photo_url);break;case"row":break}}document.addEventListener("DOMContentLoaded",yt);
